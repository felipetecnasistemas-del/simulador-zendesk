<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configura√ß√µes - Sistema Zendesk</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2.45.4"></script>
    <script src="supabase-config.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-text">
                    <h1>Configura√ß√µes do Sistema</h1>
                    <p class="subtitle">Gerenciar usu√°rios e configura√ß√µes de estimativas</p>
                </div>
                <div class="header-actions">
                    <a href="index.html" class="config-icon" title="Voltar √† p√°gina inicial">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 12H5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </a>
                </div>
            </div>
        </header>

        <main class="config-content">
            <!-- Abas de Configura√ß√£o -->
            <div class="config-tabs">
                <button class="config-tab-button active" onclick="openConfigTab(event, 'estimates-tab')">Estimativas</button>
                <button class="config-tab-button" onclick="openConfigTab(event, 'users-tab')">Usu√°rios</button>
            </div>
            
            <!-- Aba de Estimativas -->
            <div id="estimates-tab" class="config-tab-content active">
                <div class="config-section">
                    <h3>Horas por Item</h3>
                    <div class="config-grid" id="config-grid">
                        <!-- Configura√ß√µes ser√£o carregadas via JavaScript -->
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="resetToDefaults()">Restaurar Padr√µes</button>
                        <button type="button" class="btn-primary" onclick="saveConfiguration()">Salvar Configura√ß√£o</button>
                    </div>
                </div>
            </div>
            
            <!-- Aba de Usu√°rios -->
            <div id="users-tab" class="config-tab-content">
                <div class="config-section">
                    <h3>Gerenciar Usu√°rios</h3>
                    
                    <!-- Formul√°rio de Cadastro de Usu√°rio -->
                    <div class="user-form-section">
                        <h4>Adicionar Novo Usu√°rio</h4>
                        <form id="user-form" class="user-form">
                            <div class="form-group">
                                <label for="user-name">Nome Completo:</label>
                                <input type="text" id="user-name" name="name" required placeholder="Digite o nome completo">
                            </div>
                            <div class="form-group">
                                <label for="user-email">E-mail:</label>
                                <input type="email" id="user-email" name="email" required placeholder="Digite o e-mail">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn-primary">Adicionar Usu√°rio</button>
                                <button type="button" class="btn-secondary" onclick="clearUserForm()">Limpar</button>
                                <button type="button" id="cancel-edit-btn" class="btn-cancel" onclick="cancelEdit()" style="display: none;">Cancelar Edi√ß√£o</button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Lista de Usu√°rios -->
                    <div class="users-list-section">
                        <h4>Usu√°rios Cadastrados</h4>
                        <div id="users-list" class="users-list">
                            <!-- Lista ser√° carregada via JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Fun√ß√£o para alternar entre abas
        function openConfigTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("config-tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            tablinks = document.getElementsByClassName("config-tab-button");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }

        // Fun√ß√£o para limpar formul√°rio de usu√°rio
        function clearUserForm() {
            document.getElementById('user-form').reset();
        }

        // Fun√ß√£o para resetar configura√ß√µes padr√£o
        function resetToDefaults() {
            if (confirm('Tem certeza que deseja restaurar as configura√ß√µes padr√£o?')) {
                // Implementar l√≥gica de reset
                alert('Configura√ß√µes restauradas para os valores padr√£o!');
            }
        }

        // Fun√ß√£o para salvar configura√ß√µes
        function saveConfiguration() {
            alert('Configura√ß√µes salvas com sucesso!');
        }

        // Vari√°vel para controlar modo de edi√ß√£o
        let editingUserId = null;

        // Fun√ß√£o para carregar usu√°rios
        async function loadUsers() {
            try {
                const result = await SupabaseAPI.getUsers();
                if (result.error) {
                    console.error('Erro ao carregar usu√°rios:', result.error);
                    return;
                }
                
                const usersList = document.getElementById('users-list');
                if (!usersList) return;
                
                if (!result.data || result.data.length === 0) {
                    usersList.innerHTML = '<p class="no-users">Nenhum usu√°rio cadastrado</p>';
                    return;
                }
                
                usersList.innerHTML = result.data.map(user => `
                    <div class="user-item" data-user-id="${user.id}">
                        <div class="user-info">
                            <strong>${user.name}</strong>
                            <span>${user.email}</span>
                        </div>
                        <div class="user-actions">
                            <button class="btn-edit" onclick="editUser(${user.id}, '${user.name}', '${user.email}')">
                                ‚úèÔ∏è Editar
                            </button>
                            <button class="btn-delete" onclick="deleteUser(${user.id})">
                                üóëÔ∏è Excluir
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Erro ao carregar usu√°rios:', error);
            }
        }

        // Fun√ß√£o para criar usu√°rio
        async function createUser(userData) {
            try {
                const result = await SupabaseAPI.createUser(userData);
                if (result.error) {
                    alert('Erro ao criar usu√°rio: ' + result.error);
                    return;
                }
                
                alert('Usu√°rio criado com sucesso!');
                clearUserForm();
                loadUsers();
                // Atualizar lista suspensa na p√°gina principal
                if (typeof window.loadUsersForSelect === 'function') {
                    window.loadUsersForSelect();
                }
            } catch (error) {
                console.error('Erro ao criar usu√°rio:', error);
                alert('Erro ao criar usu√°rio: ' + error.message);
            }
        }

        // Fun√ß√£o para editar usu√°rio
        function editUser(id, name, email) {
            editingUserId = id;
            document.getElementById('user-name').value = name;
            document.getElementById('user-email').value = email;
            
            const submitBtn = document.querySelector('#user-form button[type="submit"]');
            submitBtn.textContent = 'Atualizar Usu√°rio';
            
            const cancelBtn = document.getElementById('cancel-edit-btn');
            if (cancelBtn) {
                cancelBtn.style.display = 'inline-block';
            }
        }

        // Fun√ß√£o para cancelar edi√ß√£o
        function cancelEdit() {
            editingUserId = null;
            clearUserForm();
            
            const submitBtn = document.querySelector('#user-form button[type="submit"]');
            submitBtn.textContent = 'Adicionar Usu√°rio';
            
            const cancelBtn = document.getElementById('cancel-edit-btn');
            if (cancelBtn) {
                cancelBtn.style.display = 'none';
            }
        }

        // Fun√ß√£o para atualizar usu√°rio
        async function updateUser(userData) {
            try {
                const result = await SupabaseAPI.updateUser(editingUserId, userData);
                if (result.error) {
                    alert('Erro ao atualizar usu√°rio: ' + result.error);
                    return;
                }
                
                alert('Usu√°rio atualizado com sucesso!');
                cancelEdit();
                loadUsers();
                // Atualizar lista suspensa na p√°gina principal
                if (typeof window.loadUsersForSelect === 'function') {
                    window.loadUsersForSelect();
                }
            } catch (error) {
                console.error('Erro ao atualizar usu√°rio:', error);
                alert('Erro ao atualizar usu√°rio: ' + error.message);
            }
        }

        // Fun√ß√£o para deletar usu√°rio
        async function deleteUser(userId) {
            if (!confirm('Tem certeza que deseja excluir este usu√°rio?')) {
                return;
            }
            
            try {
                const result = await SupabaseAPI.deleteUser(userId);
                if (result.error) {
                    alert('Erro ao excluir usu√°rio: ' + result.error);
                    return;
                }
                
                alert('Usu√°rio exclu√≠do com sucesso!');
                loadUsers();
                // Atualizar lista suspensa na p√°gina principal
                if (typeof window.loadUsersForSelect === 'function') {
                    window.loadUsersForSelect();
                }
            } catch (error) {
                console.error('Erro ao excluir usu√°rio:', error);
                alert('Erro ao excluir usu√°rio: ' + error.message);
            }
        }

        // Carregar dados quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar Supabase
            if (typeof initSupabase === 'function') {
                initSupabase();
            }
            
            // Carregar usu√°rios
            loadUsers();
            
            // Configurar formul√°rio de usu√°rio
            const userForm = document.getElementById('user-form');
            if (userForm) {
                userForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const formData = new FormData(this);
                    const userData = {
                        name: formData.get('name'),
                        email: formData.get('email')
                    };
                    
                    // Valida√ß√£o b√°sica
                    if (!userData.name || !userData.email) {
                        alert('Por favor, preencha todos os campos.');
                        return;
                    }
                    
                    if (editingUserId) {
                        updateUser(userData);
                    } else {
                        createUser(userData);
                    }
                });
            }
        });
    </script>
</body>
</html>