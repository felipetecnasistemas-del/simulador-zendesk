<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Projetos Supabase</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
</head>
<body>
    <h1>Teste de Projetos no Supabase</h1>
    <button onclick="testProjects()">Buscar Projetos</button>
    <button onclick="createTestProject()">Criar Projeto Teste</button>
    <div id="results"></div>

    <script>
        async function testProjects() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = 'Carregando...';
            
            // Aguardar inicialização
            setTimeout(async () => {
                if (typeof initSupabase === 'function') {
                    initSupabase();
                }
                
                setTimeout(async () => {
                    if (typeof SupabaseAPI !== 'undefined' && typeof SupabaseAPI.getProjects === 'function') {
                        const { data: projects, error } = await SupabaseAPI.getProjects();
                        
                        if (error) {
                            resultsDiv.innerHTML = `<p style="color: red;">Erro: ${error}</p>`;
                            return;
                        }
                        
                        if (projects && projects.length > 0) {
                            let html = '<h2>Projetos encontrados:</h2>';
                            projects.forEach(project => {
                                html += `
                                    <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
                                        <h3>${project.name}</h3>
                                        <p><strong>ID:</strong> ${project.id}</p>
                                        <p><strong>Tipo:</strong> ${project.client_type}</p>
                                        <p><strong>Criado:</strong> ${new Date(project.created_at).toLocaleString()}</p>
                                        <a href="simulador.html?projectId=${project.id}" target="_blank">Abrir no Simulador</a>
                                    </div>
                                `;
                            });
                            resultsDiv.innerHTML = html;
                        } else {
                            resultsDiv.innerHTML = '<p>Nenhum projeto encontrado.</p>';
                        }
                    } else {
                        resultsDiv.innerHTML = '<p style="color: red;">SupabaseAPI não disponível</p>';
                    }
                }, 500);
            }, 300);
        }
        
        async function createTestProject() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = 'Criando projeto teste...';
            
            // Aguardar inicialização
            setTimeout(async () => {
                if (typeof initSupabase === 'function') {
                    initSupabase();
                }
                
                setTimeout(async () => {
                    if (typeof SupabaseAPI !== 'undefined' && typeof SupabaseAPI.createProject === 'function') {
                        const testProject = {
                            name: 'Projeto Teste - ' + new Date().toLocaleString(),
                            client_type: 'enterprise',
                            is_tecna_client: true,
                            has_zendesk_admin: false
                        };
                        
                        console.log('Criando projeto:', testProject);
                        const { data: project, error } = await SupabaseAPI.createProject(testProject);
                        
                        console.log('Resultado da criação:', { project, error });
                        
                        if (error) {
                            resultsDiv.innerHTML = `<p style="color: red;">Erro ao criar projeto: ${JSON.stringify(error)}</p>`;
                            return;
                        }
                        
                        if (project) {
                            resultsDiv.innerHTML = `
                                <div style="border: 2px solid green; margin: 10px; padding: 10px;">
                                    <h3>Projeto criado com sucesso!</h3>
                                    <p><strong>ID:</strong> ${project.id}</p>
                                    <p><strong>Nome:</strong> ${project.name}</p>
                                    <a href="simulador.html?projectId=${project.id}" target="_blank">Abrir no Simulador</a>
                                </div>
                            `;
                        } else {
                            resultsDiv.innerHTML = '<p style="color: orange;">Projeto criado mas sem dados retornados</p>';
                        }
                    } else {
                        resultsDiv.innerHTML = '<p style="color: red;">SupabaseAPI não disponível</p>';
                        console.log('SupabaseAPI status:', typeof SupabaseAPI);
                        console.log('createProject function:', typeof SupabaseAPI?.createProject);
                    }
                }, 500);
            }, 300);
        }
    </script>
</body>
</html>